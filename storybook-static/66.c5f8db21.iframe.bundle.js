(self.webpackChunkstorybook_components=self.webpackChunkstorybook_components||[]).push([[66],{"./src/components/molecules/LexicalEditor/nodes/EquationComponent.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{default:()=>EquationComponent});var _templateObject,slicedToArray=__webpack_require__("./node_modules/@babel/runtime/helpers/esm/slicedToArray.js"),react=__webpack_require__("./node_modules/react/index.js"),LexicalComposerContext=__webpack_require__("./node_modules/@lexical/react/LexicalComposerContext.js"),LexicalUtils=__webpack_require__("./node_modules/@lexical/utils/LexicalUtils.js"),Lexical=__webpack_require__("./node_modules/lexical/Lexical.js"),react_error_boundary_umd=__webpack_require__("./node_modules/react-error-boundary/dist/react-error-boundary.umd.js"),taggedTemplateLiteral=__webpack_require__("./node_modules/@babel/runtime/helpers/esm/taggedTemplateLiteral.js"),styled_components_browser_esm=__webpack_require__("./node_modules/styled-components/dist/styled-components.browser.esm.js"),EquationEditorContainer=styled_components_browser_esm.ZP.span(_templateObject||(_templateObject=(0,taggedTemplateLiteral.Z)(["\n  .EquationEditor_inlineEditor {\n    padding: 0;\n    margin: 0;\n    border: 0;\n    outline: 0;\n    color: #8421a2;\n    background-color: inherit;\n    resize: none;\n  }\n\n  .EquationEditor_blockEditor {\n    padding: 0;\n    margin: 0;\n    border: 0;\n    outline: 0;\n    color: #8421a2;\n    background-color: inherit;\n    resize: none;\n    width: 100%;\n  }\n\n  .EquationEditor_inputBackground {\n    background-color: #eee;\n  }\n\n  .EquationEditor_dollarSign {\n    text-align: left;\n    color: #b0b0b0;\n  }\n"]))),__jsx=react.createElement;function EquationEditor(_ref,forwardedRef){var equation=_ref.equation,setEquation=_ref.setEquation,onChange=function onChange(event){setEquation(event.target.value)};return _ref.inline&&forwardedRef instanceof HTMLInputElement?__jsx(EquationEditorContainer,null,__jsx("span",{className:"EquationEditor_inputBackground"},__jsx("span",{className:"EquationEditor_dollarSign"},"$"),__jsx("input",{className:"EquationEditor_inlineEditor",value:equation,onChange,autoFocus:!0,ref:forwardedRef}),__jsx("span",{className:"EquationEditor_dollarSign"},"$"))):__jsx(EquationEditorContainer,null,__jsx("div",{className:"EquationEditor_inputBackground"},__jsx("span",{className:"EquationEditor_dollarSign"},"$$\n"),__jsx("textarea",{className:"EquationEditor_blockEditor",value:equation,onChange,ref:forwardedRef}),__jsx("span",{className:"EquationEditor_dollarSign"},"\n$$")))}const atoms_EquationEditor=(0,react.forwardRef)(EquationEditor);var styles_templateObject,katex=__webpack_require__("./node_modules/katex/dist/katex.mjs"),KatexRendererContainer=styled_components_browser_esm.ZP.div(styles_templateObject||(styles_templateObject=(0,taggedTemplateLiteral.Z)([""]))),KatexRenderer_jsx=react.createElement;function KatexRenderer(_ref){var equation=_ref.equation,inline=_ref.inline,onDoubleClick=_ref.onDoubleClick,katexElementRef=(0,react.useRef)(null);return(0,react.useEffect)((function(){var katexElement=katexElementRef.current;null!==katexElement&&katex.Z.render(equation,katexElement,{displayMode:!inline,errorColor:"#cc0000",output:"html",strict:"warn",throwOnError:!1,trust:!1})}),[equation,inline]),KatexRenderer_jsx(KatexRendererContainer,null,KatexRenderer_jsx("img",{src:"#",alt:""}),KatexRenderer_jsx("span",{role:"button",tabIndex:-1,onDoubleClick,ref:katexElementRef}),KatexRenderer_jsx("img",{src:"#",alt:""}))}KatexRenderer.displayName="KatexRenderer",KatexRenderer.__docgenInfo={description:"",methods:[],displayName:"KatexRenderer"};try{KatexRenderer.displayName="KatexRenderer",KatexRenderer.__docgenInfo={description:"",displayName:"KatexRenderer",props:{equation:{defaultValue:null,description:"",name:"equation",required:!0,type:{name:"string"}},inline:{defaultValue:null,description:"",name:"inline",required:!0,type:{name:"boolean"}},onDoubleClick:{defaultValue:null,description:"",name:"onDoubleClick",required:!0,type:{name:"() => void"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/components/molecules/LexicalEditor/component/atoms/KatexRenderer/index.tsx#KatexRenderer"]={docgenInfo:KatexRenderer.__docgenInfo,name:"KatexRenderer",path:"src/components/molecules/LexicalEditor/component/atoms/KatexRenderer/index.tsx#KatexRenderer"})}catch(__react_docgen_typescript_loader_error){}var EquationNode=__webpack_require__("./src/components/molecules/LexicalEditor/nodes/EquationNode.tsx"),EquationComponent_jsx=react.createElement;function EquationComponent(_ref){var equation=_ref.equation,inline=_ref.inline,nodeKey=_ref.nodeKey,_useLexicalComposerCo=(0,LexicalComposerContext.useLexicalComposerContext)(),editor=(0,slicedToArray.Z)(_useLexicalComposerCo,1)[0],_useState=(0,react.useState)(equation),equationValue=_useState[0],setEquationValue=_useState[1],_useState2=(0,react.useState)(!1),showEquationEditor=_useState2[0],setShowEquationEditor=_useState2[1],inputRef=(0,react.useRef)(null),onHide=(0,react.useCallback)((function(restoreSelection){setShowEquationEditor(!1),editor.update((function(){var node=(0,Lexical.$getNodeByKey)(nodeKey);(0,EquationNode.kj)(node)&&(node.setEquation(equationValue),restoreSelection&&node.selectNext(0,0))}))}),[editor,equationValue,nodeKey]);return(0,react.useEffect)((function(){showEquationEditor||equationValue===equation||setEquationValue(equation)}),[showEquationEditor,equation,equationValue]),(0,react.useEffect)((function(){return showEquationEditor?(0,LexicalUtils.mergeRegister)(editor.registerCommand(Lexical.SELECTION_CHANGE_COMMAND,(function(payload){var activeElement=document.activeElement;return inputRef.current!==activeElement&&onHide(),!1}),Lexical.COMMAND_PRIORITY_HIGH),editor.registerCommand(Lexical.KEY_ESCAPE_COMMAND,(function(payload){var activeElement=document.activeElement;return inputRef.current===activeElement&&(onHide(!0),!0)}),Lexical.COMMAND_PRIORITY_HIGH)):editor.registerUpdateListener((function(_ref2){_ref2.editorState.read((function(){var selection=(0,Lexical.$getSelection)();return(0,Lexical.$isNodeSelection)(selection)&&selection.has(nodeKey)&&1===selection.getNodes().length}))&&setShowEquationEditor(!0)}))}),[editor,nodeKey,onHide,showEquationEditor]),EquationComponent_jsx(react.Fragment,null,showEquationEditor?EquationComponent_jsx(atoms_EquationEditor,{equation:equationValue,setEquation:setEquationValue,inline,ref:inputRef}):EquationComponent_jsx(react_error_boundary_umd.ErrorBoundary,{onError:function onError(e){return editor._onError(e)},fallback:null},EquationComponent_jsx(KatexRenderer,{equation:equationValue,inline,onDoubleClick:function onDoubleClick(){return setShowEquationEditor(!0)}})))}EquationComponent.__docgenInfo={description:"",methods:[],displayName:"EquationComponent",props:{equation:{required:!0,tsType:{name:"string"},description:""},inline:{required:!0,tsType:{name:"boolean"},description:""},nodeKey:{required:!0,tsType:{name:"NodeKey"},description:""}}};try{EquationComponent.displayName="EquationComponent",EquationComponent.__docgenInfo={description:"",displayName:"EquationComponent",props:{equation:{defaultValue:null,description:"",name:"equation",required:!0,type:{name:"string"}},inline:{defaultValue:null,description:"",name:"inline",required:!0,type:{name:"boolean"}},nodeKey:{defaultValue:null,description:"",name:"nodeKey",required:!0,type:{name:"string"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/components/molecules/LexicalEditor/nodes/EquationComponent.tsx#EquationComponent"]={docgenInfo:EquationComponent.__docgenInfo,name:"EquationComponent",path:"src/components/molecules/LexicalEditor/nodes/EquationComponent.tsx#EquationComponent"})}catch(__react_docgen_typescript_loader_error){}},"./node_modules/react-error-boundary/dist/react-error-boundary.umd.js":function(__unused_webpack_module,exports,__webpack_require__){!function(exports,React){"use strict";function _interopNamespace(e){if(e&&e.__esModule)return e;var n=Object.create(null);return e&&Object.keys(e).forEach((function(k){if("default"!==k){var d=Object.getOwnPropertyDescriptor(e,k);Object.defineProperty(n,k,d.get?d:{enumerable:!0,get:function(){return e[k]}})}})),n.default=e,Object.freeze(n)}var React__namespace=_interopNamespace(React);function _setPrototypeOf(o,p){return _setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(o,p){return o.__proto__=p,o},_setPrototypeOf(o,p)}function _inheritsLoose(subClass,superClass){subClass.prototype=Object.create(superClass.prototype),subClass.prototype.constructor=subClass,_setPrototypeOf(subClass,superClass)}var changedArray=function changedArray(a,b){return void 0===a&&(a=[]),void 0===b&&(b=[]),a.length!==b.length||a.some((function(item,index){return!Object.is(item,b[index])}))},initialState={error:null},ErrorBoundary=function(_React$Component){function ErrorBoundary(){for(var _this,_len=arguments.length,_args=new Array(_len),_key=0;_key<_len;_key++)_args[_key]=arguments[_key];return(_this=_React$Component.call.apply(_React$Component,[this].concat(_args))||this).state=initialState,_this.resetErrorBoundary=function(){for(var _this$props,_len2=arguments.length,args=new Array(_len2),_key2=0;_key2<_len2;_key2++)args[_key2]=arguments[_key2];null==_this.props.onReset||(_this$props=_this.props).onReset.apply(_this$props,args),_this.reset()},_this}_inheritsLoose(ErrorBoundary,_React$Component),ErrorBoundary.getDerivedStateFromError=function getDerivedStateFromError(error){return{error}};var _proto=ErrorBoundary.prototype;return _proto.reset=function reset(){this.setState(initialState)},_proto.componentDidCatch=function componentDidCatch(error,info){var _this$props$onError,_this$props2;null==(_this$props$onError=(_this$props2=this.props).onError)||_this$props$onError.call(_this$props2,error,info)},_proto.componentDidUpdate=function componentDidUpdate(prevProps,prevState){var _this$props$onResetKe,_this$props3,error=this.state.error,resetKeys=this.props.resetKeys;null!==error&&null!==prevState.error&&changedArray(prevProps.resetKeys,resetKeys)&&(null==(_this$props$onResetKe=(_this$props3=this.props).onResetKeysChange)||_this$props$onResetKe.call(_this$props3,prevProps.resetKeys,resetKeys),this.reset())},_proto.render=function render(){var error=this.state.error,_this$props4=this.props,fallbackRender=_this$props4.fallbackRender,FallbackComponent=_this$props4.FallbackComponent,fallback=_this$props4.fallback;if(null!==error){var _props={error,resetErrorBoundary:this.resetErrorBoundary};if(React__namespace.isValidElement(fallback))return fallback;if("function"==typeof fallbackRender)return fallbackRender(_props);if(FallbackComponent)return React__namespace.createElement(FallbackComponent,_props);throw new Error("react-error-boundary requires either a fallback, fallbackRender, or FallbackComponent prop")}return this.props.children},ErrorBoundary}(React__namespace.Component);function withErrorBoundary(Component,errorBoundaryProps){var Wrapped=function Wrapped(props){return React__namespace.createElement(ErrorBoundary,errorBoundaryProps,React__namespace.createElement(Component,props))},name=Component.displayName||Component.name||"Unknown";return Wrapped.displayName="withErrorBoundary("+name+")",Wrapped}function useErrorHandler(givenError){var _React$useState=React__namespace.useState(null),error=_React$useState[0],setError=_React$useState[1];if(null!=givenError)throw givenError;if(null!=error)throw error;return setError}exports.ErrorBoundary=ErrorBoundary,exports.useErrorHandler=useErrorHandler,exports.withErrorBoundary=withErrorBoundary,Object.defineProperty(exports,"__esModule",{value:!0})}(exports,__webpack_require__("./node_modules/react/index.js"))}}]);